upstream gateway {
    server  gateway:8000;
}

upstream edge {
    server  edge:8000;
}

server {
    server_name _;
    listen 8081 ssl http2 default_server;
    listen [::]:8081 ssl http2 default_server;
    ssl_certificate /etc/ssl/certs/nginx-selfsigned.crt;
    ssl_certificate_key /etc/ssl/private/nginx-selfsigned.key;

    location = /api/v1 {
        return 302 /api/v1/;
    }
    location /api/v1/ {
        proxy_pass http://gateway/;
        client_max_body_size 10000M;
    }
    location / {
        proxy_pass http://edge/;
    }
}
